# AI应用威胁建模引擎

这是一个**AI应用威胁建模引擎**，专注于需求阶段和设计阶段的安全威胁识别。

** 核心能力：**
- **威胁建模**：接收需求输入 → 输出定制化威胁模型文档
- **风险评估**：基于STRIDE方法论 + 26个AI威胁知识库
- **场景化分析**：针对Agent/RAG/多模态/MCP应用的专项分析
- **修复计划**：P0/P1/P2分级修复计划 + 时间表

---

## 工作流程

```
输入阶段
├─ 应用类型（对话助手/Agent/RAG/多模态/MCP）
├─ 功能场景（核心业务流程）
├─ 架构信息（技术栈/网络开放/数据类型）
└─ 补充信息（认证/权限/日志）
↓
威胁建模阶段
├─ 筛选适用威胁（从26个威胁库）
├─ 场景化威胁描述
├─ 识别攻击链
└─ 评估风险等级（STRIDE方法）
↓
输出阶段
├─ 威胁模型文档（10个核心部分）
├─ 风险矩阵（热力图 + 优先级排序）
├─ 修复计划（P0/P1/P2 + 具体任务）
└─ 测试用例（安全测试建议）
```

---

## 特点

- **威胁建模驱动**：从需求阶段开始识别安全风险
- **26个威胁知识库**：覆盖提示词层、模型层、智能体层
- **STRIDE方法论**：系统化的威胁识别框架
- **场景化分析**：针对具体应用场景的定制化威胁描述
- **可操作修复计划**：P0/P1/P2分级 + 时间表 + 验证标准
- **完整模板体系**：输入问卷 + 输出模板 + 评估报告

---

## 快速开始

### 1. 威胁建模（主要使用场景）

**适用：** 需求阶段、设计阶段

1. **填写输入问卷**：`templates/threat-modeling-input.md`
- 应用类型和功能场景
- 架构和技术栈
- 数据类型和网络开放性

2. **AI分析生成**：威胁建模引擎自动识别适用威胁

3. **输出威胁模型**：基于 `templates/threat-modeling-output.md`
- 威胁清单（STRIDE分类）
- 风险矩阵和优先级
- 修复计划（P0/P1/P2）

### 2. 安全评估（已有应用）

**适用：** 开发完成后的安全评估

使用 `templates/security-report-template.md` 模板对已实现的应用进行安全评估。

### 3. 威胁查询

查阅 `threats/` 目录下的26个威胁文档，了解具体威胁的原理、危害和修复方式。

### 4. 理解威胁全景

阅读 `威胁关联分析.md`，了解威胁之间的关联关系、典型攻击链和防御策略。

---

## 文件结构

```
ai-security-threat/
├── README.md # 项目说明
├── SKILL.md # Cursor技能文档（威胁建模引擎使用说明）
├── 威胁关联分析.md # 威胁关联、攻击链、防御策略
├── threats/ # 26个威胁文档（知识库）
│ ├── [提示词层] 2个
│ ├── [模型层] 9个
│ └── [智能体层] 15个
└── templates/ # 模板目录
├── threat-modeling-input.md # 威胁建模输入问卷
├── threat-modeling-output.md # 威胁建模输出模板
└── security-report-template.md # 安全评估报告模板（已有应用）
```

---

## 威胁知识库

### 1. 提示词层安全 (2个)
- **系统提示词涉及敏感信息** (P1)
- **系统提示词恶意指令** (P1)

### 2. 模型层安全 (9个)

#### 2.1 模型越狱 (4个)
- **单模态：文字交互提示词注入** (P0)
- **多模态：间接提示词注入** (P0)
- **混淆编码攻击** (P1)
- **角色扮演攻击** (P1)
- **渐进式攻击威胁** (P2)

#### 2.2 模型拒绝服务 (2个)
- **模型的并发控制缺失** (P2)
- **模型交互资源耗尽** (P2)

#### 2.3 训练安全 (3个)
- **训练数据知识库数据范围控制缺失** (P0)
- **训练数据投毒** (P1)
- **训练数据交互式获取** (P2)

### 3. 智能体层安全 (15个)

#### 3.1 供应链与操作边界 (2个)
- **封装层组件漏洞** (P1)
- **封装层操作边界控制缺陷** (P0)

#### 3.2 MCP与权限控制 (4个)
- **MCP权限校验缺陷** (P0)
- **封装层服务未授权** (P0)
- **封装层API越权-IDOR** (P1)
- **封装层服务功能级别的越权** (P1)

#### 3.3 代码执行安全 (2个)
- **SQL注入** (P0)
- **命令/代码执行** (P0)

#### 3.4 Web安全与前端 (2个)
- **XSS跨站脚本** (P1)
- **前端敏感信息泄露** (P1)

#### 3.5 文件交互安全 (2个)
- **任意文件操作** (P1)
- **路径遍历** (P1)

#### 3.6 日志审计 (2个)
- **日志缺失风险** (P2)
- **敏感日志打印风险** (P1)

---

## 威胁分类统计

| 威胁类别 | 数量 | 风险等级分布 |
|---------|------|------------|
| 提示词层 | 2 | P1: 2 |
| 模型层-越狱 | 4 | P0: 1, P1: 2, P2: 1 |
| 模型层-DoS | 2 | P2: 2 |
| 训练安全 | 3 | P0: 1, P1: 1, P2: 1 |
| 智能体-MCP/权限 | 4 | P0: 2, P1: 2 |
| 智能体-代码执行 | 2 | P0: 2 |
| 智能体-Web安全 | 2 | P1: 2 |
| 智能体-文件操作 | 2 | P1: 2 |
| 智能体-日志审计 | 2 | P1: 1, P2: 1 |
| 智能体-组件安全 | 1 | P1: 1 |
| **总计** | **26** | **P0: 8, P1: 15, P2: 3** |

---

## 使用示例

### 场景1：新项目威胁建模

```
用户：我们要做一个企业知识库问答助手

AI：我是AI威胁建模引擎，我会帮您识别安全威胁。

请告诉我：
1. 是RAG应用吗？
2. 核心功能场景（2-3个）
3. 是否互联网开放？
4. 知识库包含什么数据？
5. 使用什么模型服务？

[收集信息后]

AI：基于您的输入，我识别到12个适用威胁：
- P0威胁3个（需立即修复）
- P1威胁7个（30天内修复）
- P2威胁2个（90天内修复）

最关键的3个风险：
1. 提示词注入导致知识库越权访问
2. 训练数据包含企业敏感信息未隔离
3. API缺少身份认证

[输出完整威胁模型文档...]
```

### 场景2：威胁查询

```
用户：什么是提示词注入？

AI：提示词注入是P0级别严重威胁。

[展开具体内容...]

详见：threats/单模态：文字交互提示词注入.txt
```

---

## 在Cursor中使用

1. 将本项目克隆到本地
2. 在Cursor中开启该技能
3. 询问AI："我要做威胁建模"
4. 按照引导提供信息
5. 获取定制化威胁模型文档

---

## 持续更新

建议在以下时机重新进行威胁建模：
- 新功能上线前
- 架构重大变更时
- 每季度定期review
- 发生安全事件后

---

## License

MIT

---

*AI应用威胁建模引擎 v2.0*
*基于26个AI安全威胁知识库与STRIDE方法论*
